<%@ taglib uri="/struts-tags" prefix="s"%> <%@ taglib uri="http://java.sun.com/jstl/core_rt" prefix="c"%> <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%> <%@ taglib prefix="tiles" uri="http://tiles.apache.org/tags-tiles"%> <tiles:insertDefinition name="baseLayout"> <tiles:putAttribute name="title" value="Hello WebSocket" type="String"/> <tiles:putAttribute name="java_script" type="String"> <script src="sockjs-0.3.4.js"></script> <script src="stomp.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script> <script type="text/javascript">var token=$("meta[name='_csrf']").attr("content");var header=$("meta[name='_csrf_header']").attr("content");</script> <script type="text/javascript">var ws=new WebSocket("ws://localhost:8080/TemplateWebApp/wst/ws-questions");ws.onopen=function(){ws.send("i am opened..")};ws.onmessage=function(a){console.log("message="+a.data);$("#questions").prepend("<br>");$("#questions").prepend(a.data)};ws.onlcose=function(a){console.log("closed="+a.data)};function postQuestion(){ws.send($("#newQuestionText").val())};</script> <script type="text/javascript">var stompClient=null;function setConnected(a){document.getElementById("connect").disabled=a;document.getElementById("disconnect").disabled=!a;document.getElementById("conversationDiv").style.visibility=a?"visible":"hidden";document.getElementById("response").innerHTML=""}function connect(){var a=new SockJS("/TemplateWebApp/wst/hello");stompClient=Stomp.over(a);stompClient.connect({},function(b){setConnected(true);console.log("Connected: "+b);stompClient.subscribe("/topic/greetings",function(c){showGreeting(JSON.parse(c.body).content)})})}function onLoadHandler(){}function disconnect(){if(stompClient!=null){stompClient.disconnect()}setConnected(false);console.log("Disconnected")}function sendName(){var a=document.getElementById("name").value;stompClient.send("/app/hello",{},JSON.stringify({name:a}))}function showGreeting(b){var a=document.getElementById("response");var c=document.createElement("p");c.style.wordWrap="break-word";c.appendChild(document.createTextNode(b));a.appendChild(c)};</script> </tiles:putAttribute> <tiles:putAttribute name="menu" value="" type="String"/> <tiles:putAttribute name="body"> <div> <form id="newQuestionForm" onsubmit="return false;"> Question : <input type="text" id="newQuestionText"/> <button onclick="postQuestion();">Post Question</button> <div id="questions"></div> </form> </div> <div> <div> <button id="connect" onclick="connect();">Connect</button> <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button> </div> <div id="conversationDiv"> <label>What is your name?</label><input type="text" id="name"/> <button id="sendName" onclick="sendName();">Send</button> <p id="response"></p> </div> </div> </tiles:putAttribute> </tiles:insertDefinition> </html>